# Release Firmware

## Thông tin firmware

* Tên:              esp_mesh_touch_fw
* Phiên bản:        2.0.0
* Link:             [Gitlab](https://git.sunshinetech.vn/dev/firmware/firmware/esp-smarthome-wifi-mesh-fw/commit/2651506557bedc85abfd0edbd1dd0cfe7ec55ced)
* Ngày thử nghiệm   12/2/2020
* Ngày release      
* Phần cứng hỗ trợ: Touch ver 1, Touch ver 2, Touch ver 3, Curtain ver 3, IR Gateway

## Kết quả thử nghiệm

### Mesh network

| STT           | Danh mục                               | Mô tả                                             | Ngày thực hiện | Thời gian thực hiện | Kết quả  | Ghi chú                                                         |
|---------------|----------------------------------------|---------------------------------------------------|----------------|---------------------|----------|-----------------------------------------------------------------|
| 1             | Khởi tạo mạng Mesh                     | Khởi tạo mạng mesh khi có WiFi                    |                |                     | &#x2611; | Test trên 33 thiết bị                                           |
|               |                                        | Khởi tạo mạng mesh khi không có WiFi              |                |                     | &#x2612; | Mạng mesh không thể hình thành, các thiết bị không kết nối mạng |
| 2             | Thêm node                              | Thêm node mới vào mạng mesh                       |                |                     | &#x2611; |                                                                 |
| 3             | Xóa node                               | Xoát một node bất kì                              |                |                     | &#x2611; |                                                                 |
| 4             | Xóa root                               | Xóa root ra khỏi mạng Mesh                        |                |                     | &#x2611; |                                                                 |
| 5             | Kết nối WiFi tiếng Việt                | Tạo mạng mesh bằng WiFi tiếng Việt, kí tự lạ      |                |                     | &#x2611; |                                                                 |
| 6             | PING/PONG websocket                    | Router vẫn phát WiFi nhưng ngắt kết nối Websocket |                |                     | &#x2611; |                                                                 |
| 7             | Duy trì Mesh khi mất WiFi              | Mạng Mesh được duy trì khi mất sóng WiFi          |                |                     | &#x2611; | Mesh sẽ vẫn hoạt động nếu có tồn tại parent                     |
| 8             | Waive root                             | Quay root khi disconnect WS                       |                |                     | &#x2611; | Bỏ tính năng Waive root khi disconnect websocket                |
| 9             | Root Bridge                            | Điều khiển bắt cầu khi offline                    |                |                     | &#x2611; | Server chưa hỗ trợ message cho Root Bridge                      |
| 10            | Phân biệt mesh dev/pro                 |                                                   |                |                     | &#x2611; |                                                                 |
| 11            | Reg device qua Websocket/HTTP                 | Đăng kí thiết bị bằng Websocket và HTTP     |                |                     | &#x2611; |                                                                 |
| 12            | Không khởi động mesh khi chưa cấu hình | Không khởi động mạng Mesh khi chưa được cấu hình  |                |                     | &#x2611; |                                                                 |

### Touch

| STT                      | Danh mục                            | Mô tả                                                     | Ngày thực hiện | Thời gian thực hiện | Kết quả  | Ghi chú                                                                                                              |
|--------------------------|-------------------------------------|-----------------------------------------------------------|----------------|---------------------|----------|----------------------------------------------------------------------------------------------------------------------|
| Test phần cứng           |                                     |                                                           |                |                     |          |                                                                                                                      |
| 1                        | Bật tắt bằng tay                    | Bật tắt liên tục bằng tay.                                |                |                     | &#x2611; |                                                                                                                      |
| 2                        | Hardware auto detect                | TÍnh năng auto detect hw đối với các phiên bản touch      |                |                     | &#x2611; |                                                                                                                      |
| 3                        | Thứ tự nút touch, relay             | Kiểm tra thứ tự touch, relay, LED có đúng không?          |                |                     | &#x2611; | Đã fix thứ tự màu LED touch 3 so với phiên bản củ                                                                    |
| 4                        | Độ nhạy                             | Test độ nhạy, kiễm tra nhiễu đối với touch ESP            |                |                     | &#x2611; | Cần thay đổi ngưỡng độ nhạy DAC (giamr ngưỡng tối đa xuống 85%). Giảm độ nhạy touch ESP.                             |
| 5                        | Điều chỉnh độ nhạy touch ESP        |                                                           |                |                     | &#x2611; | App chưa hỗ trợ chỉnh độ nhạy cho Touch 1-20A-ver1-ver2-ver3                                                         |
| 6                        | Dimmer đèn buổi tối                 | Giảm độ sáng đèn sau 6h tối                               |                |                     | &#x2611; | App chưa hỗ trợ chỉnh độ sáng cho Touch 1-20A-ver1-ver2-ver3                                                         |
| 7                        | Treo touch khi khởi động            | Kiểm tra touch có bị treo khi khởi động                   |                |                     | &#x2611; | Phiên bản ver1, ver2 chưa được fix bằng phần cứng                                                                    |
| 8                        | LED behavior                        | Kiểm tra các hiệu ứng LED                                 |                |                     | &#x2611; | 1 lần/5s: Chưa kết nối WiFi, 3 lần/3s: Đã kết nối WiFi, 1 lân/5s: vào chế độ cấu hình, không nháy: Đã kết nối Server |
|                          |                                     |                                                           |                |                     | &#x2612; |                                                                                                                      |
| Test API (App SmartHome) |                                     |                                                           |                |                     |          |                                                                                                                      |
| 1                        | Đăng kí thiết bị                    | Kiểm tra thông tin thiêt bị đăng kí trên server           |                |                     | &#x2611; |                                                                                                                      |
| 2                        | OTA                                 | Cập nhật chương trình                                     |                |                     | &#x2611; |                                                                                                                      |
| 3                        | Điều khiển từ xa                    | Điều khiển và lấy trạng thái nút touch                    |                |                     | &#x2611; |                                                                                                                      |
| 4                        | Boot State                          | Thiết lập boot state                                      |                |                     | &#x2611; |                                                                                                                      |
| 5                        | Lên lịch                            | Lên lịch bật tắt                                          |                |                     | &#x2611; |                                                                                                                      |
| 6                        | Kịch bản                            | Thiết lập và chạy kịch bản                                |                |                     | &#x2611; |                                                                                                                      |
| 7                        | Điều khiển bằng GG Assistant        | Liên kết với GG Home vầ điều khiển bằng giọng nói         |                |                     | &#x2611; | Hiện tại chỉ hổ trợ điều khiển bằng tiếng anh                                                                        |
| Test config mode         |                                     |                                                           |                |                     |          |                                                                                                                      |
| 1                        | Enter configmode                    | Nhấn giữ nút touch bất kì trong 5s để vào chế độ cấu hình |                |                     | &#x2611; |                                                                                                                      |
| 2                        | Check OTA khi exit config mode      | Kiểm tra cập nhật OTA khi exit config mode                |                |                     | &#x2611; |                                                                                                                      |
| 3                        | BluFi                               | Kiểm tra thông tin touch, bật tắt thiết bị qua BluFi      |                |                     | &#x2611; |                                                                                                                      |
| 4                        | Webserver                           | Kiểm tra thông tin, cấu hình WiFi, Access Key, Access ID  |                |                     | &#x2612; | Không hỗ trợ config bằng webserver                                                                                   |
| Stress test              |                                     |                                                           |                |                     |          |                                                                                                                      |
| 1                        | Treo thiết bị                       | Treo thiết bị liên tục trong thời gian dài                |                |                     | &#x2611; |                                                                                                                      |
| 2                        | Leak memory                         | Kiểm tra Leak Memory root và node                         |                |                     | &#x2611; |                                                                                                                      |
| 3                        | Stress control                      | Bât tắt thiết bị từ xa liên tục chu kì 2s/lần             |                |                     | &#x2611; |                                                                                                                      |
| 4                        | Chạy kịch bản bật/tắt full liên tục | Bật tắt full thiết bị liên tục                            |                |                     | &#x2611; | Bật/tắt 32 thiết bị liện tục thường dẫn đến tình trạng root bị reset                                                 |                                                                                                                |

### IR Gateway

| STT                      | Danh mục                             | Mô tả                                                                               | Ngày thực hiện | Thời gian thực hiện | Kết quả  | Ghi chú                                                                    |
|--------------------------|--------------------------------------|-------------------------------------------------------------------------------------|----------------|---------------------|----------|----------------------------------------------------------------------------|
| Test phần cứng           |                                      |                                                                                     |                |                     |          |                                                                            |
| 1                        | Nút nhấn                             | Bật tắt liên tục bằng tay.                                                          |                |                     | &#x2611; |                                                                            |
| 2                        | Hardware auto detect                 |                                                                                     |                |                     | &#x2611; |                                                                            |
| 3                        | Reset, treo khi khởi động            |                                                                                     |                |                     | &#x2612; | Chưa fix bằng phần cứng (supervisor)                                       |
| 4                        | Độ nhạy                              | Kiểm tra độ nhạy, chất lượng nút nhấn                                               |                |                     | &#x2611; |                                                                            |
| 5                        | Khoảng cách truyền và góc phát RF    |                                                                                     |                |                     | &#x2611; | Khoảng cách truyền khoảng 7-8m                                             |
| 6                        | Khoảng cách truyền và góc phát IR    |                                                                                     |                |                     | &#x2611; | Khoảng cách truyển nhận khoảng 5-7m, góc phát ~150 độ                      |
| 7                        | Đọc nhiệt độ, độ ẩm từ cảm biến      |                                                                                     |                |                     | &#x2611; |                                                                            |
| 8                        | Giao tiếp với máy lạnh               |                                                                                     |                |                     | &#x2611; | Hỗ trợ chuẩn SPI, UART, HomeBus                                            |
| 9                        | LED behavior                         | Kiểm tra các hiệu ứng LED                                                           |                |                     | &#x2611; |                                                                            |
| Test API (App SmartHome) |                                      |                                                                                     |                |                     |          |                                                                            |
| 1                        | Đăng kí thiết bị                     | Kiểm tra thông tin thiêt bị đăng kí trên server                                     |                |                     | &#x2611; |                                                                            |
| 2                        | OTA                                  | Cập nhật chương trình                                                               |                |                     | &#x2611; |                                                                            |
| 3                        | Học lệnh và điều khiển IR            | Học lệnh và điều khiển IR từ xa                                                     |                |                     | &#x2611; |                                                                            |
| 4                        | Học lệnh và điều khiển RF            | Học lệnh và điều khiển RF từ xa                                                     |                |                     | &#x2611; |                                                                            |
| 5                        | Điều khiển máy lạnh                  | Kết nối và điều khiển máy lạnh từ xa                                                |                |                     | &#x2611; |                                                                            |
| 6                        | Phản hồi nhiệt độ, độ ẩm lên app     | Đọc dữ liệu nhiệt độ từ cảm biến/máy lạnh gửi lên server                            |                |                     | &#x2611; |                                                                            |
| 7                        | Lên lịch                             | Lên lịch bật tắt                                                                    |                |                     | &#x2611; |                                                                            |
| 8                        | Hẹn giờ                              | Hẹn giờ điều khiển điều hòa                                                         |                |                     | &#x2611; | App không cho phép điều khiển hẹn giờ khi máy lạnh đang tắt                |
| 9                        | Kịch bản                             | Thiết lập và chạy kịch bản                                                          |                |                     | &#x2611; |                                                                            |
| 10                       | Điều chỉnh mode                      | Thay đổi mode máy lạnh                                                              |                |                     | &#x2611; |                                                                            |
| 11                       | Điều chỉnh fan                       | Thây đổi tốc độ quạt máy lạnh                                                       |                |                     | &#x2611; |                                                                            |
| 12                       | Điều chỉnh swing                     | Thay đổi hướng thổi máy lạnh                                                        |                |                     | &#x2611; |                                                                            |
| 13                       | Điều khiển bằng GG Assistant         | Liên kết với GG Home vầ điều khiển bằng giọng nói                                   |                |                     | &#x2612; | App chưa thể đặt tên cho thiết bị (không thể điều khiển bằng tên mặc định) |
| Test config mode         |                                      |                                                                                     |                |                     |          |                                                                            |
| 1                        | Enter configmode                     | Nhấn giữ nút nhấn hoặc bật tắt sau khi nghe tiếng beep 3 lần để vào chế độ cấu hình |                |                     | &#x2611; |                                                                            |
| 2                        | Enter configmode bằng cách bật nguồn | Bật tắt nguồn 3 lần để vào config mode                                              |                |                     | &#x2611; |                                                                            |
| 3                        | Check OTA khi exit config mode       | Kiểm tra cập nhật OTA khi exit config mode                                          |                |                     | &#x2611; |                                                                            |
| 4                        | BluFi                                | kiểm tra thông tin, cấu hình thiết bị.                                              |                |                     | &#x2611; |                                                                            |
| 5                        | Webserver                            | kiểm tra thông tin, cấu hình thiết bị                                               |                |                     | &#x2612; |                                                                            |
| Stress test              |                                      |                                                                                     |                |                     |          |                                                                            |
| 1                        | Treo thiết bị                        | Treo thiết bị liên tục trong thời gian dài                                          |                |                     | &#x2611; |                                                                            |
| 2                        | Reset, leak memory                   | Treo thiết bị và kiểm tra có bị leak memory, reset                                  |                |                     | &#x2611; |                                                                            |
| 3                        | Stress control                       | Phát IR, RF liên tục                                                                |                |                     | &#x2611; |                                                                            |
| 4                        |                                      |                                                                                     |                |                     | &#x2612; |                                                                            |
| Lỗi phát sinh            |                                      |                                                                                     |                |                     |          |                                                                            |
| 1                        | Lỗi khi khởi dộng                    | Xác thực với máy lạnh bị lỗi khi mesh khởi động (đã fix)                                     |                |                     | &#x2611; | Đã fix                                                                     |

### Curtain

| STT                      | Danh mục                            | Mô tả                                                     | Ngày thực hiện | Thời gian thực hiện | Kết quả  | Ghi chú                                                                                                              |
|--------------------------|-------------------------------------|-----------------------------------------------------------|----------------|---------------------|----------|----------------------------------------------------------------------------------------------------------------------|
| Test phần cứng           |                                     |                                                           |                |                     |          |                                                                                                                      |
| 1                        | Bật tắt bằng tay                    | Bật tắt liên tục bằng tay.                                |                |                     | &#x2611; |                                                                                                                      |
| 2                        | Hardware auto detect                |                                                           |                |                     | &#x2611; |                                                                                                                      |
| 3                        | Thứ tự nút điều khiển, động cơ rèm  | Kiểm tra thứ tự touch, relay, LED có đúng không?          |                |                     | &#x2611; |                                                                                                                      |
| 4                        | Độ nhạy                             | Test độ nhạy, kiễm tra nhiễu đối với touch 1.             |                |                     | &#x2611; |                                                                                                                      |
| 5                        | Reset, treo khi khởi động           | Treo thiết bị và kiểm tra có bị leak memory, reset        |                |                     | &#x2611; |                                                                                                                      |
| 6                        | LED behavior                        | Kiểm tra các hiệu ứng LED                                 |                |                     | &#x2611; | 1 lần/5s: Chưa kết nối WiFi, 3 lần/3s: Đã kết nối WiFi, 1 lân/5s: vào chế độ cấu hình, không nháy: Đã kết nối Server |
| 7                        | Hỗ trợ rèm đơn/đôi                  | Hỗ trợ điều khiển rèm đơn/đôi                             |                |                     | &#x2611; |                                                                                                                      |
| Test API (App SmartHome) |                                     |                                                           |                |                     |          |                                                                                                                      |
| 1                        | Đăng kí thiết bị                    | Kiểm tra thông tin thiêt bị đăng kí trên server           |                |                     | &#x2611; |                                                                                                                      |
| 2                        | OTA                                 | Cập nhật chương trình                                     |                |                     | &#x2611; |                                                                                                                      |
| 3                        | ĐIều khiển từ xa                    | Đóng mở rèm từ xa và phản hồi vị trí rèm hiện tại         |                |                     | &#x2611; |                                                                                                                      |
| 4                        | Boot State                          | Vị trí rèm khi công tắc khởi động                         |                |                     | &#x2611; |                                                                                                                      |
| 5                        | Lên lịch                            | Lên lịch đóng mở rèm                                      |                |                     | &#x2611; |                                                                                                                      |
| 6                        | Kịch bản                            | Thiết lập và chạy kịch bản                                |                |                     | &#x2611; |                                                                                                                      |
| 7                        | Điều khiển bằng GG Assistant        | Liên kết với GG Home vầ điều khiển bằng giọng nói         |                |                     | &#x2611; |                                                                                                                      |
| Test config mode         |                                     |                                                           |                |                     |          |                                                                                                                      |
| 1                        | Enter configmode                    | Nhấn giữ nút touch bất kì trong 5s để vào chế độ cấu hình |                |                     | &#x2611; |                                                                                                                      |
| 2                        | Check OTA khi exit config mode      | Kiểm tra cập nhật OTA khi exit config mode                |                |                     | &#x2611; |                                                                                                                      |
| 3                        | BluFi                               | Kiểm tra thông tin touch, bật tắt thiết bị qua BluFi      |                |                     | &#x2611; |                                                                                                                      |
| 4                        | Webserver                           | Kiểm tra thông tin, cấu hình WiFi, Access Key, Access ID  |                |                     | &#x2612; | Không hỗ trợ                                                                                                         |
| Stress test              |                                     |                                                           |                |                     |          |                                                                                                                      |
| 1                        | Treo thiết bị                       | Treo thiết bị liên tục trong thời gian dài                |                |                     | &#x2611; |                                                                                                                      |
| 2                        | Leak memory                         | Kiểm tra Leak Memory root và node                         |                |                     | &#x2611; |                                                                                                                      |
| 3                        | Stress control                      | Bât tắt thiết bị từ xa liên tục chu kì 2s/lần             |                |                     | &#x2611; |                                                                                                                      |
| 4                        | Chạy kịch bản bật/tắt full liên tục | Bật tắt full thiết bị liên tục                            |                |                     | &#x2611; |                                                                                                                      |